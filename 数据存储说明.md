# ğŸ“¦ æ•°æ®å­˜å‚¨è¯´æ˜

## ğŸ¯ æ–°å¢åŠŸèƒ½ï¼šæœ¬åœ°æ•°æ®æŒä¹…åŒ–

### v2.1 æ›´æ–°å†…å®¹

ç³»ç»Ÿç°åœ¨ä¼šè‡ªåŠ¨å°†æ‰€æœ‰ä¼šè¯æ•°æ®å’Œä¸Šä¼ æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œå³ä½¿æœåŠ¡å™¨é‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ï¼

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ data/                    # ä¼šè¯æ•°æ®å­˜å‚¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ session_id_1/
â”‚   â”‚   â””â”€â”€ session.json    # ä¼šè¯è¯¦ç»†ä¿¡æ¯
â”‚   â”œâ”€â”€ session_id_2/
â”‚   â”‚   â””â”€â”€ session.json
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ uploads/                 # ä¸Šä¼ çš„æ–‡ä»¶
â”‚   â”œâ”€â”€ session_company_a_bank_timestamp.pdf
â”‚   â”œâ”€â”€ session_company_a_commitment_timestamp.pdf
â”‚   â”œâ”€â”€ session_company_b_bank_timestamp.pdf
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ å¤‡ä»½-v2.0-20251128/      # ä»£ç å¤‡ä»½
â””â”€â”€ ...
```

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–æœºåˆ¶

### 1. ä¼šè¯æ•°æ®å­˜å‚¨

**å­˜å‚¨ä½ç½®ï¼š** `data/{session_id}/session.json`

**å­˜å‚¨æ—¶æœºï¼š**
- âœ… åˆ›å»ºä¼šè¯æ—¶
- âœ… åŠ å…¥ä¼šè¯æ—¶
- âœ… ä¸Šä¼ æ–‡ä»¶å
- âœ… æäº¤æµæ°´é‡‘é¢å
- âœ… æŸ¥çœ‹æ¯”è¾ƒç»“æœå

**å­˜å‚¨å†…å®¹ï¼š**
```json
{
  "session_id": "abc123...",
  "created_at": "2025-11-28T20:00:00",
  "status": "revealed",
  "company_a": {
    "name": "ç§‘æŠ€å…¬å¸A",
    "committed": true,
    "level": 2,
    "level_info": {
      "level": 2,
      "name": "æˆé•¿çº§",
      "description": "100ä¸‡-1000ä¸‡"
    },
    "bank_statement": "æ–‡ä»¶å.pdf",
    "commitment_letter": "æ‰¿è¯ºä¹¦.pdf",
    "files_uploaded": true
  },
  "company_b": {
    "name": "ä¼ä¸šB",
    "committed": true,
    "level": 3,
    "level_info": {
      "level": 3,
      "name": "å‘å±•çº§",
      "description": "1000ä¸‡-1äº¿"
    },
    "bank_statement": "æ–‡ä»¶å.pdf",
    "commitment_letter": "æ‰¿è¯ºä¹¦.pdf",
    "files_uploaded": true
  },
  "result": {
    "comparison": "lower",
    "message": "ä¼ä¸šBçš„æµæ°´æ¡£æ¬¡æ›´é«˜",
    "company_a": {...},
    "company_b": {...}
  }
}
```

### 2. æ–‡ä»¶å­˜å‚¨

**å­˜å‚¨ä½ç½®ï¼š** `uploads/`

**æ–‡ä»¶å‘½åè§„åˆ™ï¼š**
```
{session_id}_{role}_{type}_{timestamp}_{original_name}

ç¤ºä¾‹ï¼š
abc123_company_a_bank_20251128200000_æµæ°´.pdf
abc123_company_a_commitment_20251128200000_æ‰¿è¯ºä¹¦.pdf
abc123_company_b_bank_20251128200100_statement.pdf
abc123_company_b_commitment_20251128200100_letter.pdf
```

**ä¼˜ç‚¹ï¼š**
- é€šè¿‡æ–‡ä»¶åå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ä¼šè¯
- åŒ…å«æ—¶é—´æˆ³ï¼Œæ°¸ä¸é‡å¤
- ä¿ç•™åŸå§‹æ–‡ä»¶åä¾¿äºè¯†åˆ«

---

## ğŸ”„ è‡ªåŠ¨æ¢å¤æœºåˆ¶

### æœåŠ¡å™¨é‡å¯åçš„è¡Œä¸º

**1. å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å†å²ä¼šè¯**
```python
# æœåŠ¡å™¨å¯åŠ¨æ—¶æ‰§è¡Œ
load_all_sessions()
# âœ… å·²åŠ è½½ N ä¸ªå†å²ä¼šè¯
```

**2. ä¼šè¯çŠ¶æ€æ¢å¤**
- æ‰€æœ‰æœªå®Œæˆçš„ä¼šè¯å¯ä»¥ç»§ç»­
- å·²å®Œæˆçš„ä¼šè¯å¯ä»¥æŸ¥çœ‹å†å²
- æ–‡ä»¶å…³è”å…³ç³»ä¿æŒå®Œæ•´

**3. ç”¨æˆ·ä½“éªŒ**
- ç”¨æˆ·åˆ·æ–°é¡µé¢åå¯ä»¥æ¢å¤ä¼šè¯
- ä¸ä¼šå› æœåŠ¡å™¨é‡å¯ä¸¢å¤±æ•°æ®
- å†å²è®°å½•å¯è¿½æº¯

---

## ğŸ“Š æ•°æ®ç®¡ç†API

### 1. æŸ¥çœ‹å†å²è®°å½•

**æ¥å£ï¼š** `GET /api/history`

**è¿”å›ï¼š**
```json
{
  "success": true,
  "count": 5,
  "history": [
    {
      "session_id": "abc123...",
      "created_at": "2025-11-28T20:00:00",
      "company_a_name": "ç§‘æŠ€å…¬å¸A",
      "company_b_name": "ä¼ä¸šB",
      "result": {
        "comparison": "lower",
        "message": "ä¼ä¸šBçš„æµæ°´æ¡£æ¬¡æ›´é«˜"
      }
    },
    ...
  ]
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
curl http://localhost:5001/api/history
```

### 2. å¯¼å‡ºä¼šè¯æ•°æ®

**æ¥å£ï¼š** `GET /api/export/{session_id}`

**è¿”å›ï¼š**
```json
{
  "success": true,
  "data": {
    "session_id": "abc123...",
    "created_at": "2025-11-28T20:00:00",
    "status": "revealed",
    "company_a": {
      "name": "ç§‘æŠ€å…¬å¸A",
      "level": {...},
      "files": {
        "bank_statement": "æ–‡ä»¶å.pdf",
        "commitment_letter": "æ‰¿è¯ºä¹¦.pdf"
      }
    },
    "company_b": {...},
    "result": {...}
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
curl http://localhost:5001/api/export/abc123...
```

---

## ğŸ› ï¸ æ•°æ®ç®¡ç†æ“ä½œ

### æŸ¥çœ‹æ‰€æœ‰ä¼šè¯

```bash
# è¿›å…¥dataç›®å½•
cd data

# åˆ—å‡ºæ‰€æœ‰ä¼šè¯
ls -l

# æŸ¥çœ‹ç‰¹å®šä¼šè¯
cat abc123.../session.json | python -m json.tool
```

### æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶

```bash
# è¿›å…¥uploadsç›®å½•
cd uploads

# åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
ls -lh

# æŒ‰æ—¶é—´æ’åº
ls -lt

# æŒ‰å¤§å°æ’åº
ls -lS
```

### ç»Ÿè®¡æ•°æ®

```bash
# ä¼šè¯æ€»æ•°
ls data/ | wc -l

# æ–‡ä»¶æ€»æ•°
ls uploads/ | wc -l

# æ–‡ä»¶æ€»å¤§å°
du -sh uploads/

# å„ç±»æ–‡ä»¶ç»Ÿè®¡
ls uploads/*_bank_* | wc -l    # é“¶è¡Œæµæ°´
ls uploads/*_commitment_* | wc -l  # æ‰¿è¯ºä¹¦
```

### æ¸…ç†è¿‡æœŸæ•°æ®

```bash
# åˆ é™¤30å¤©å‰çš„ä¼šè¯ï¼ˆæ…ç”¨ï¼ï¼‰
find data/ -type d -mtime +30 -exec rm -rf {} \;

# åˆ é™¤30å¤©å‰çš„æ–‡ä»¶
find uploads/ -type f -mtime +30 -delete

# æ¸…ç†ç‰¹å®šä¼šè¯
rm -rf data/abc123...
rm uploads/abc123...*
```

---

## ğŸ”’ æ•°æ®å®‰å…¨

### 1. æ–‡ä»¶æƒé™

**å»ºè®®è®¾ç½®ï¼š**
```bash
# dataç›®å½•åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
chmod 700 data/

# uploadsç›®å½•åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
chmod 700 uploads/

# ä¼šè¯æ–‡ä»¶åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
chmod 600 data/*/session.json

# ä¸Šä¼ æ–‡ä»¶åªæœ‰æ‰€æœ‰è€…å¯è¯»
chmod 600 uploads/*
```

### 2. æ•æ„Ÿä¿¡æ¯

**ä¼šè¯æ•°æ®ä¸­ä¸åŒ…å«ï¼š**
- âŒ å…·ä½“æµæ°´é‡‘é¢ï¼ˆåªå­˜å‚¨æ¡£æ¬¡ï¼‰
- âŒ å¯†é’¥å’Œéšæœºæ•°ï¼ˆsecretï¼‰
- âŒ ç”¨æˆ·å¯†ç æˆ–è®¤è¯ä¿¡æ¯

**ä¼šè¯æ•°æ®åŒ…å«ï¼š**
- âœ… å…¬å¸åç§°
- âœ… æ¡£æ¬¡ç­‰çº§
- âœ… æ–‡ä»¶å¼•ç”¨ï¼ˆæ–‡ä»¶åï¼‰
- âœ… æ¯”è¾ƒç»“æœ

### 3. å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > backup_data.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="æ•°æ®å¤‡ä»½_$DATE"

mkdir -p "$BACKUP_DIR"
cp -r data/ "$BACKUP_DIR/"
cp -r uploads/ "$BACKUP_DIR/"

tar -czf "$BACKUP_DIR.tar.gz" "$BACKUP_DIR"
rm -rf "$BACKUP_DIR"

echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR.tar.gz"
EOF

chmod +x backup_data.sh

# è¿è¡Œå¤‡ä»½
./backup_data.sh
```

---

## ğŸ“ˆ æ•°æ®åˆ†æ

### 1. ä¼šè¯ç»Ÿè®¡

```python
# åœ¨Pythonä¸­åˆ†æ
import json
import os
from collections import Counter

# ç»Ÿè®¡æ¡£æ¬¡åˆ†å¸ƒ
levels = []
for session_id in os.listdir('data'):
    session_file = os.path.join('data', session_id, 'session.json')
    if os.path.exists(session_file):
        with open(session_file) as f:
            data = json.load(f)
            if data.get('company_a', {}).get('level'):
                levels.append(data['company_a']['level'])
            if data.get('company_b', {}).get('level'):
                levels.append(data['company_b']['level'])

print("æ¡£æ¬¡åˆ†å¸ƒï¼š")
for level, count in Counter(levels).items():
    print(f"  Level {level}: {count} å®¶å…¬å¸")
```

### 2. å¯¼å‡ºæŠ¥è¡¨

```python
# ç”ŸæˆCSVæŠ¥è¡¨
import csv

def export_to_csv(output_file='sessions_report.csv'):
    with open(output_file, 'w', newline='', encoding='utf-8') as f:
        writer = csv.writer(f)
        writer.writerow(['ä¼šè¯ID', 'åˆ›å»ºæ—¶é—´', 'å…¬å¸A', 'å…¬å¸B', 'æ¡£æ¬¡A', 'æ¡£æ¬¡B', 'ç»“æœ'])
        
        for session_id in os.listdir('data'):
            session_file = os.path.join('data', session_id, 'session.json')
            if os.path.exists(session_file):
                with open(session_file) as sf:
                    data = json.load(sf)
                    writer.writerow([
                        session_id,
                        data.get('created_at'),
                        data['company_a'].get('name'),
                        data['company_b'].get('name'),
                        data['company_a'].get('level'),
                        data['company_b'].get('level'),
                        data.get('result', {}).get('message')
                    ])
    
    print(f"âœ… æŠ¥è¡¨å·²å¯¼å‡º: {output_file}")

export_to_csv()
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç£ç›˜ç©ºé—´

**ä¼°ç®—ï¼š**
- æ¯ä¸ªä¼šè¯ï¼š~10-20MBï¼ˆåŒ…å«æ–‡ä»¶ï¼‰
- 100ä¸ªä¼šè¯ï¼š~1-2GB
- å»ºè®®é¢„ç•™ï¼š5GBä»¥ä¸Š

**ç›‘æ§ï¼š**
```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h .

# æŸ¥çœ‹é¡¹ç›®å¤§å°
du -sh data/ uploads/
```

### 2. Gitç®¡ç†

**é‡è¦ï¼š** `data/` å’Œ `uploads/` å·²æ·»åŠ åˆ° `.gitignore`

- âœ… ä¸ä¼šæäº¤åˆ°Git
- âœ… ä¿æŠ¤ç”¨æˆ·éšç§
- âœ… é¿å…ä»“åº“è¿‡å¤§

**å¦‚éœ€å¤‡ä»½ï¼š**
```bash
# ä½¿ç”¨å…¶ä»–æ–¹å¼å¤‡ä»½æ•°æ®
rsync -av data/ /path/to/backup/data/
rsync -av uploads/ /path/to/backup/uploads/
```

### 3. ç”Ÿäº§ç¯å¢ƒ

**å»ºè®®æ”¹è¿›ï¼š**
- ä½¿ç”¨ä¸“ä¸šæ•°æ®åº“ï¼ˆPostgreSQLã€MongoDBï¼‰
- æ–‡ä»¶å­˜å‚¨ä½¿ç”¨OSSï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰
- æ·»åŠ æ•°æ®åŠ å¯†
- å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- è®¾ç½®è®¿é—®æƒé™æ§åˆ¶

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå¯åŠ¨æ—¶æç¤ºåŠ è½½ä¼šè¯å¤±è´¥

**æ£€æŸ¥ï¼š**
```bash
# æ£€æŸ¥dataç›®å½•æ˜¯å¦å­˜åœ¨
ls -ld data/

# æ£€æŸ¥æƒé™
ls -l data/

# æ£€æŸ¥JSONæ–‡ä»¶æ ¼å¼
python -m json.tool data/xxx/session.json
```

**è§£å†³ï¼š**
```bash
# é‡æ–°åˆ›å»ºç›®å½•
mkdir -p data/

# ä¿®å¤æƒé™
chmod 700 data/
```

### é—®é¢˜2ï¼šæ–‡ä»¶æ‰¾ä¸åˆ°

**æ£€æŸ¥ï¼š**
```bash
# ç¡®è®¤æ–‡ä»¶å­˜åœ¨
ls uploads/

# æ£€æŸ¥ä¼šè¯ä¸­çš„æ–‡ä»¶å
cat data/xxx/session.json | grep -E "bank_statement|commitment_letter"
```

### é—®é¢˜3ï¼šæ•°æ®å ç”¨è¿‡å¤šç©ºé—´

**æ¸…ç†ï¼š**
```bash
# åªä¿ç•™æœ€è¿‘30å¤©çš„æ•°æ®
find data/ -type f -mtime +30 -delete
find uploads/ -type f -mtime +30 -delete

# å‹ç¼©æ—§æ•°æ®
find uploads/ -type f -name "*.pdf" -mtime +7 -exec gzip {} \;
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **README.md** - é¡¹ç›®ä¸»æ–‡æ¡£
- **æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½è¯´æ˜.md** - æ–‡ä»¶ä¸Šä¼ è¯¦è§£
- **v2.0å‡çº§æŒ‡å—.md** - ç‰ˆæœ¬å‡çº§è¯´æ˜
- **é¡¹ç›®åä½œæŒ‡å—.md** - å›¢é˜Ÿåä½œ

---

**ç‰ˆæœ¬ï¼š** v2.1  
**æ›´æ–°æ—¥æœŸï¼š** 2025-11-28  
**çŠ¶æ€ï¼š** âœ… ç”Ÿäº§å¯ç”¨

**æ•°æ®ç°åœ¨å®‰å…¨æŒä¹…åŒ–åˆ°æœ¬åœ°äº†ï¼** ğŸ‰

