# 🚀 v2.0 升级指南

## 📦 版本信息

- **当前版本：** v2.0
- **备份版本：** v1.2.3 (保存在 `备份-v1.2.3-20251128/` 目录)
- **升级日期：** 2025-11-28
- **升级类型：** ⚠️ 破坏性更新

## 🎯 主要变化

### ✨ 新增功能

#### 1. 文件上传系统 ⭐ 核心功能
- **银行流水文件上传**（必须）
- **承诺书文件上传**（必须）
- **文件格式验证**（PDF、PNG、JPG、JPEG）
- **文件大小限制**（10MB）
- **上传进度显示**

#### 2. 安全增强
- 文件服务器端存储
- 文件与会话绑定
- 防止虚假申报
- 可追溯审计

### 🔄 功能变更

#### 之前（v1.x）
```
1. 输入公司名称
2. 输入流水金额 ← 可以随意输入
3. 点击提交
4. 查看结果
```

#### 现在（v2.0）
```
1. 输入公司名称
2. 上传银行流水文件 ← 新增
3. 上传承诺书文件 ← 新增
4. 输入流水金额（需与文件一致）
5. 点击提交（会先上传文件）
6. 查看结果
```

## 📋 升级前准备

### 1. 备份数据
```bash
# 已自动备份到：
/Users/renzhenzhen/Documents/博二/课程/创新创业能力实战/备份-v1.2.3-20251128/
```

### 2. 准备测试文件

#### 测试用银行流水（示例）
- 可以使用任意PDF或图片
- 文件名如：`test_bank_statement.pdf`
- 大小不超过10MB

#### 测试用承诺书（使用提供的模板）
```bash
# 承诺书模板位置：
承诺书模板.md

# 制作方法：
1. 打开模板
2. 填写信息
3. 导出为PDF或截图
4. 准备上传
```

## 🧪 快速测试

### 测试步骤

#### 步骤1：启动服务器
```bash
cd "/Users/renzhenzhen/Documents/博二/课程/创新创业能力实战"
python app.py
```

确认看到：
```
 * Running on http://127.0.0.1:5000
```

#### 步骤2：检查uploads目录
```bash
ls -la uploads/
# 应该看到空目录（首次运行）
```

#### 步骤3：打开浏览器测试
```
1. 打开两个浏览器窗口
窗口A: http://localhost:5000
窗口B: http://localhost:5000

2. 窗口A - 创建会话
   - 点击"发起比较"
   - 输入公司名："测试公司A"
   - 复制会话ID

3. 窗口B - 加入会话
   - 点击"加入比较"
   - 粘贴会话ID
   - 输入公司名："测试公司B"

4. 窗口A - 上传文件
   - 点击"选择文件"（银行流水）
   - 选择测试PDF文件
   - 点击"选择文件"（承诺书）
   - 选择承诺书文件
   - 输入金额：500000
   - 点击"加密并提交"
   - 观察上传进度

5. 窗口B - 上传文件
   - 重复相同操作
   - 输入金额：5000000
   - 提交

6. 查看结果
   - 两个窗口都应显示比较结果
   - 服务器 uploads/ 目录应有4个文件
```

#### 步骤4：验证文件存储
```bash
cd uploads/
ls -la

# 应该看到类似：
# abc123_company_a_bank_20251128195030_statement.pdf
# abc123_company_a_commitment_20251128195030_letter.pdf  
# abc123_company_b_bank_20251128195031_statement.pdf
# abc123_company_b_commitment_20251128195031_letter.pdf
```

## 🎨 UI 变化

### 输入界面新增元素

#### 1. 文件上传区域
```
┌─────────────────────────────────┐
│ 📄 银行流水文件 *              │
│ ┌─────────────────────────────┐ │
│ │ [📎 选择文件] 文件名.pdf    │ │
│ └─────────────────────────────┘ │
│ 支持 PDF、PNG、JPG，最大 10MB  │
└─────────────────────────────────┘
```

#### 2. 上传进度显示
```
┌─────────────────────────────────┐
│ [████████████░░░░░░] 75%        │
│ 正在上传文件...                 │
└─────────────────────────────────┘
```

#### 3. 成功提示
```
┌─────────────────────────────────┐
│ [████████████████████] 100%     │
│ ✅ 文件上传成功                 │
└─────────────────────────────────┘
```

## 🐛 可能遇到的问题

### 问题1：提示"请先上传文件"

**原因：** 点击提交前未选择文件

**解决：**
1. 确保两个文件都已选择
2. 文件名显示不是"未选择文件"
3. 文件上传区域边框变绿

### 问题2：上传失败

**检查：**
```bash
# 1. 查看uploads目录权限
ls -ld uploads/
# 应该有写权限

# 2. 查看服务器日志
# 终端应该显示 POST /api/upload_files 200

# 3. 检查文件大小
# 不能超过10MB
```

**解决：**
```bash
# 如果uploads目录不存在或无权限
mkdir -p uploads
chmod 755 uploads
```

### 问题3：文件格式不支持

**支持的格式：**
- PDF：`.pdf`
- 图片：`.png`、`.jpg`、`.jpeg`

**不支持的格式：**
- Word：`.doc`、`.docx`
- Excel：`.xls`、`.xlsx`
- 其他：`.txt`、`.zip` 等

**解决：**
1. 转换为PDF格式
2. 或截图保存为PNG/JPG

### 问题4：服务器重启后文件还在吗？

**是的！** 
- 文件存储在 `uploads/` 目录
- 即使服务器重启，文件仍然存在
- 但会话数据会丢失（内存存储）

## 📊 性能影响

### 文件上传时间估算

| 文件大小 | 本地环境 | 局域网 | 互联网 |
|---------|----------|--------|--------|
| 1MB     | <1秒     | 1-2秒  | 3-5秒  |
| 5MB     | 1-2秒    | 3-5秒  | 10-15秒|
| 10MB    | 2-3秒    | 5-8秒  | 20-30秒|

### 存储空间

每次比较需要：
- 2个公司 × 2个文件 = 4个文件
- 平均每个文件 2-5MB
- 每次比较约需 10-20MB 存储空间

建议：
- 定期清理 `uploads/` 目录
- 或者实现自动过期删除

## 🔧 回滚方案

如果需要回滚到 v1.2.3：

```bash
cd "/Users/renzhenzhen/Documents/博二/课程/创新创业能力实战"

# 备份当前版本
mkdir 备份-v2.0-临时
cp -r * 备份-v2.0-临时/

# 恢复v1.2.3
cp -r 备份-v1.2.3-20251128/* .

# 重启服务器
python app.py
```

## 📚 相关文档

1. **文件上传功能说明.md** - 详细的功能说明
2. **承诺书模板.md** - 承诺书模板和填写指南
3. **README.md** - 完整的系统文档

## ✅ 升级检查清单

升级完成后，请确认：

- [ ] 服务器能正常启动
- [ ] `uploads/` 目录已创建
- [ ] 前端页面正常显示
- [ ] 可以选择文件
- [ ] 文件大小和格式验证工作正常
- [ ] 上传进度正常显示
- [ ] 文件能成功上传到服务器
- [ ] uploads/ 目录有文件生成
- [ ] 提交流程正常工作
- [ ] 双方都能看到结果

## 🎓 用户培训要点

如果要给其他人使用，需要说明：

1. ⚠️ **必须上传文件**
   - 不是可选项，是必须的
   - 两个文件都要上传

2. 📄 **文件要求**
   - 银行流水：真实的银行账户流水
   - 承诺书：签字盖章的承诺文件

3. 💰 **金额一致性**
   - 输入的金额要与银行流水一致
   - 会被保存用于核验

4. 🔒 **法律责任**
   - 虚假申报将承担法律责任
   - 文件会被保存作为证据

## 📞 技术支持

遇到问题：
1. 查看浏览器Console（F12）
2. 查看服务器终端日志
3. 检查 `uploads/` 目录
4. 查看相关文档

---

**恭喜！您已成功升级到 v2.0！** 🎉

现在系统更加安全、可靠、符合实际商业需求！


